<div class="main">
  <h1>Mass Effect 2 Final Mission Calculator</h1>

  <mat-stepper orientation="vertical" [linear]="true" #stepper>
    <!-- 1. Squadmate Status -->
    <mat-step [stepControl]="squadmates" [editable]="false">
      <ng-template matStepLabel>Squadmate Status</ng-template>

      <h2>What is the status of the squad?</h2>

      <p>
        A minimum of 8 recruited squadmates is required to progress to the final
        mission.
      </p>

      <form
        [formGroup]="squadmates"
        (ngSubmit)="submitSquadmateStatus(stepper)"
      >
        <div class="squadmate-form">
          <div class="squadmate">
            <p><strong>Name</strong></p>
            <strong>Recruited?</strong>
            <strong>Loyal?</strong>
          </div>

          <div class="squadmate" formGroupName="zaeed">
            <p>Zaeed</p>
            <mat-checkbox formControlName="recruited"></mat-checkbox>
            <mat-checkbox formControlName="loyal"></mat-checkbox>
          </div>

          <div class="squadmate" formGroupName="legion">
            <p>Legion</p>
            <mat-checkbox formControlName="recruited"></mat-checkbox>
            <mat-checkbox formControlName="loyal"></mat-checkbox>
          </div>

          <div class="squadmate" formGroupName="samara">
            <p>{{ samaraIsMorinth ? "Morinth" : "Samara" }}</p>
            <mat-checkbox formControlName="recruited"></mat-checkbox>
            <mat-checkbox formControlName="loyal"></mat-checkbox>
          </div>

          <div class="squadmate" formGroupName="tali">
            <p>Tali</p>
            <mat-checkbox formControlName="recruited"></mat-checkbox>
            <mat-checkbox formControlName="loyal"></mat-checkbox>
          </div>

          <div class="squadmate" formGroupName="mordin">
            <p>Mordin<em>*</em></p>
            <mat-checkbox formControlName="recruited"></mat-checkbox>
            <mat-checkbox formControlName="loyal"></mat-checkbox>
          </div>

          <div class="squadmate" formGroupName="garrus">
            <p>Garrus<em>*</em></p>
            <mat-checkbox formControlName="recruited"></mat-checkbox>
            <mat-checkbox formControlName="loyal"></mat-checkbox>
          </div>

          <div class="squadmate" formGroupName="miranda">
            <p>Miranda<em>*</em></p>
            <mat-checkbox formControlName="recruited"></mat-checkbox>
            <mat-checkbox formControlName="loyal"></mat-checkbox>
          </div>

          <div class="squadmate" formGroupName="grunt">
            <p>Grunt</p>
            <mat-checkbox formControlName="recruited"></mat-checkbox>
            <mat-checkbox formControlName="loyal"></mat-checkbox>
          </div>

          <div class="squadmate" formGroupName="jacob">
            <p>Jacob<em>*</em></p>
            <mat-checkbox formControlName="recruited"></mat-checkbox>
            <mat-checkbox formControlName="loyal"></mat-checkbox>
          </div>

          <div class="squadmate" formGroupName="thane">
            <p>Thane</p>
            <mat-checkbox formControlName="recruited"></mat-checkbox>
            <mat-checkbox formControlName="loyal"></mat-checkbox>
          </div>

          <div class="squadmate" formGroupName="jack">
            <p>Jack<em>*</em></p>
            <mat-checkbox formControlName="recruited"></mat-checkbox>
            <mat-checkbox formControlName="loyal"></mat-checkbox>
          </div>

          <div class="squadmate" formGroupName="kasumi">
            <p>Kasumi</p>
            <mat-checkbox formControlName="recruited"></mat-checkbox>
            <mat-checkbox formControlName="loyal"></mat-checkbox>
          </div>
        </div>

        <mat-checkbox
          id="simCheckbox"
          [checked]="samaraIsMorinth"
          (change)="samaraIsMorinth = !samaraIsMorinth"
          [labelPosition]="'before'"
          >Samara is Morinth</mat-checkbox
        >

        <p>
          <small><em>*</em> indicates required squadmates.</small>
        </p>

        <div *ngIf="insufficientSquadmates">
          <p>
            <em
              >Less than 8 squadmates were recruited. A minimum of 8 recruited
              squadmates is required to progress to the final mission.</em
            >
          </p>
        </div>

        <button
          mat-raised-button
          color="primary"
          [disabled]="!squadmates.valid"
        >
          Next
        </button>
      </form>
    </mat-step>

    <!-- 2. Ship Upgrades -->
    <mat-step [editable]="false">
      <ng-template matStepLabel>Ship Upgrades</ng-template>

      <h2>What upgrades has the Normandy acquired?</h2>

      <form [formGroup]="shipUpgrades" (ngSubmit)="submitShipUpgrades(stepper)">
        <div class="squadmate-form">
          <!-- <div class="squadmate">
            <p><strong>Name</strong></p>
            <strong>Included?</strong>
          </div> -->

          <div class="squadmate" formGroupName="armor">
            <p>Heavy Ship Armor</p>
            <mat-checkbox formControlName="included"></mat-checkbox>
          </div>

          <div class="squadmate" formGroupName="shield">
            <p>Multicore Shielding</p>
            <mat-checkbox formControlName="included"></mat-checkbox>
          </div>

          <div class="squadmate" formGroupName="weapons">
            <p>Thanix Cannon</p>
            <mat-checkbox formControlName="included"></mat-checkbox>
          </div>
        </div>

        <button mat-raised-button color="primary" type="submit">Next</button>
      </form>
    </mat-step>

    <!-- 3. The Oculus -->
    <mat-step [editable]="false">
      <ng-template matStepLabel>Omega-4 Relay: The Oculus</ng-template>

      <form
        [formGroup]="oculusSquadmates"
        (ngSubmit)="submitOculusSquadmates(stepper)"
      >
        <div class="multiple-select">
          <h2>Who will accompany Shepard to fight the Oculus?</h2>

          <mat-form-field appearance="fill">
            <mat-label>Squadmate 1</mat-label>
            <mat-select formControlName="oculusSquadmate1" #oculusSquadmate1>
              <mat-option
                *ngFor="let squadmate of choosableSquadmates"
                [value]="squadmate"
                [disabled]="oculusSquadmate2.value === squadmate"
              >
                {{ squadmate }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Squadmate 2</mat-label>
            <mat-select formControlName="oculusSquadmate2" #oculusSquadmate2>
              <mat-option
                *ngFor="let squadmate of choosableSquadmates"
                [value]="squadmate"
                [disabled]="oculusSquadmate1.value === squadmate"
              >
                {{ squadmate }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <button
          mat-raised-button
          color="primary"
          type="submit"
          [disabled]="!oculusSquadmates.valid"
        >
          Next
        </button>
      </form>
    </mat-step>

    <!-- 4. Infiltration -->
    <mat-step [editable]="false">
      <ng-template matStepLabel>Collector Base: Infiltration</ng-template>

      <form
        [formGroup]="infiltrationTeam"
        (ngSubmit)="submitInfiltrationTeam(stepper)"
      >
        <div class="multiple-select">
          <h2>Who will go through the vents?</h2>

          <mat-form-field appearance="fill">
            <mat-label>Tech Specialist</mat-label>
            <mat-select formControlName="techSpecialist" #techSpecialist>
              <mat-option
                *ngFor="let specialist of techSpecialists"
                [value]="specialist"
                [disabled]="fireteamOneLeader.value === specialist"
              >
                {{ specialist }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <h2>Who will lead the first fireteam?</h2>

          <mat-form-field appearance="fill">
            <mat-label>Fireteam Leader 1</mat-label>
            <mat-select formControlName="fireteamOneLeader" #fireteamOneLeader>
              <mat-option
                *ngFor="let leader of fireteamOneLeaders"
                [value]="leader"
                [disabled]="techSpecialist.value === leader"
              >
                {{ leader }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <button
          mat-raised-button
          color="primary"
          type="submit"
          [disabled]="!infiltrationTeam.valid"
        >
          Next
        </button>
      </form>
    </mat-step>

    <!-- 5. The Long Walk -->
    <mat-step [editable]="false">
      <ng-template matStepLabel>Collector Base: The Long Walk</ng-template>

      <form [formGroup]="longWalkTeam" (ngSubmit)="submitLongWalkTeam(stepper)">
        <div class="multiple-select">
          <h2>Who will create the biotic shield?</h2>

          <mat-form-field appearance="fill">
            <mat-label>Biotic Specialist</mat-label>
            <mat-select formControlName="bioticSpecialist" #bioticSpecialist>
              <mat-option
                *ngFor="let specialist of bioticSpecialists"
                [value]="specialist"
                [disabled]="
                  fireteamTwoLeader.value === specialist ||
                  crewEscort.value === specialist ||
                  swarmSquadmate1.value === specialist ||
                  swarmSquadmate2.value === specialist
                "
              >
                {{ specialist }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <h2>Who will lead the second fireteam?</h2>

          <mat-form-field appearance="fill">
            <mat-label>Fireteam Leader 2</mat-label>
            <mat-select formControlName="fireteamTwoLeader" #fireteamTwoLeader>
              <mat-option
                *ngFor="let leader of fireteamOneLeaders"
                [value]="leader"
                [disabled]="
                  bioticSpecialist.value === leader ||
                  crewEscort.value === leader ||
                  swarmSquadmate1.value === leader ||
                  swarmSquadmate2.value === leader
                "
              >
                {{ leader }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <h2>Who will escort the crew?</h2>

          <mat-form-field appearance="fill">
            <mat-label>Crew Escort</mat-label>
            <mat-select formControlName="crewEscort" #crewEscort>
              <mat-option value="None"> None </mat-option>

              <ng-container *ngIf="getAliveSquadmates() > 4">
                <mat-option
                  *ngFor="let squadmate of choosableSquadmates"
                  [value]="squadmate"
                  [disabled]="
                    bioticSpecialist.value === squadmate ||
                    fireteamTwoLeader.value === squadmate ||
                    swarmSquadmate1.value === squadmate ||
                    swarmSquadmate2.value === squadmate ||
                    squadmate === 'Miranda'
                  "
                >
                  {{ squadmate }}
                </mat-option>
              </ng-container>
            </mat-select>
          </mat-form-field>

          <h2>Who will accompany Shepard through the seeker swarms?</h2>

          <mat-form-field appearance="fill">
            <mat-label>Squadmate 1</mat-label>
            <mat-select formControlName="swarmSquadmate1" #swarmSquadmate1>
              <mat-option
                *ngFor="let squadmate of choosableSquadmates"
                [value]="squadmate"
                [disabled]="
                  bioticSpecialist.value === squadmate ||
                  fireteamTwoLeader.value === squadmate ||
                  crewEscort.value === squadmate ||
                  swarmSquadmate2.value === squadmate
                "
              >
                {{ squadmate }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Squadmate 2</mat-label>
            <mat-select formControlName="swarmSquadmate2" #swarmSquadmate2>
              <mat-option
                *ngFor="let squadmate of choosableSquadmates"
                [value]="squadmate"
                [disabled]="
                  bioticSpecialist.value === squadmate ||
                  fireteamTwoLeader.value === squadmate ||
                  crewEscort.value === squadmate ||
                  swarmSquadmate1.value === squadmate
                "
              >
                {{ squadmate }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <button
          mat-raised-button
          color="primary"
          type="submit"
          [disabled]="!longWalkTeam.valid"
        >
          Next
        </button>
      </form>
    </mat-step>

    <!-- 6. Final Battle -->
    <mat-step [editable]="false">
      <ng-template matStepLabel>Collector Base: Final Battle</ng-template>

      <form
        [formGroup]="finalBattleTeam"
        (ngSubmit)="submitFinalBattle(stepper)"
      >
        <div class="multiple-select">
          <h2 id="htl">Who will accompany Shepard to the final battle?</h2>
          <p>
            Anyone who does not accompany Shepard will stay behind to hold the
            line.
          </p>

          <mat-form-field appearance="fill">
            <mat-label>Squadmate 1</mat-label>
            <mat-select formControlName="finalSquadmate1" #finalSquadmate1>
              <mat-option
                *ngFor="let squadmate of choosableSquadmates"
                [value]="squadmate"
                [disabled]="finalSquadmate2.value === squadmate"
              >
                {{ squadmate }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="fill">
            <mat-label>Squadmate 2</mat-label>
            <mat-select formControlName="finalSquadmate2" #finalSquadmate2>
              <mat-option
                *ngFor="let squadmate of choosableSquadmates"
                [value]="squadmate"
                [disabled]="finalSquadmate1.value === squadmate"
              >
                {{ squadmate }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <button
          mat-raised-button
          color="primary"
          type="submit"
          [disabled]="!finalBattleTeam.valid"
        >
          Next
        </button>
      </form>
    </mat-step>

    <!-- 7. Hold the Line -->
    <mat-step [editable]="false">
      <ng-template matStepLabel>Collector Base: Hold the Line</ng-template>

      <h2 id="htl">Hold the Line!</h2>
      <p>
        There {{ currentHtlScores.size > 1 ? "are" : "is" }}
        <strong>{{ currentHtlScores.size }}</strong> squadmate{{
          currentHtlScores.size > 1 ? "s" : ""
        }}
        holding the line. Their individual score{{
          currentHtlScores.size > 1 ? "s are" : " is"
        }}
        as follows:
      </p>

      <ul>
        <ng-container *ngFor="let entry of currentHtlScores | keyvalue">
          <li>{{ entry.key }}: {{ entry.value }}</li>
        </ng-container>
      </ul>

      The total squadmate score is <strong>{{ totalHtlScore }}</strong
      >.

      <p>
        <strong>{{
          htlScore == currentHtlScores.size ? 'All' : htlScore
        }}</strong>
        squadmate{{ htlScore > 1 ? 's' : '' }} holding the line will survive. ({{ totalHtlScore }} / 3 =
        {{ htlScore }} rounded down)
      </p>

      <button mat-raised-button color="primary" matStepperNext>Finish</button>
    </mat-step>

    <!-- 8. Final Outcome -->
    <mat-step [editable]="false">
      <ng-template matStepLabel>Final Outcome</ng-template>

      <ul>
        <ng-container *ngFor="let squadmate of availableSquadmates">
          <li
            *ngIf="squadmate.recruited"
            [style.color]="squadmate.deathReason ? 'red' : 'green'"
          >
            {{ squadmate.name }} -
            {{
              squadmate.deathReason
                ? "Died (" + squadmate.deathReason.toLowerCase() + ")"
                : "Survived"
            }}
          </li>
        </ng-container>
        <li [style.color]="normandyCrewDead ? 'red' : 'green'">
          Normandy Crew -
          {{ normandyCrewDead ? "Died (no escort)" : "Survived" }}
        </li>
        <li [style.color]="getAliveSquadmates() < 2 ? 'red' : 'green'">
          Shepard -
          {{
            getAliveSquadmates() < 2
              ? "Died (less than 2 squadmates survived)"
              : "Survived"
          }}
        </li>
      </ul>

      Refresh the page to reset.
      <!-- <button mat-raised-button color="primary" (click)="squadmates.reset; stepper.reset()">
        Reset
      </button> -->

      <h2>
        Decisions Summary
        <!-- <button
          mat-icon-button
          [cdkCopyToClipboard]="
            'If you are seeing this, the copy text feature has not been fully implemented yet :('
          "
        >
          <mat-icon>content_copy</mat-icon>
        </button> -->
      </h2>

      <!-- <h3>Squadmate Status</h3>
<pre>{{ availableSquadmates | squadmatesStatus }}</pre> -->

      <h3>Squadmate Status</h3>
      <!-- <pre>{{ squadmates.value | json }}</pre> -->
      <ul>
        <li *ngFor="let squadmate of squadmates.value | keyvalue">
          <ng-container *ngIf="squadmate.value">
            {{ squadmate.value.name | titlecase }}:
            {{ squadmate.value.recruited ? "Recruited" : "Not Recruited" }}
            <ng-container *ngIf="squadmate.value.recruited"
              >and
              {{ squadmate.value.loyal ? "Loyal" : "Not Loyal" }}</ng-container
            ></ng-container
          >
        </li>
      </ul>

      <h3>Ship Upgrades</h3>
      <!-- <pre>{{ shipUpgrades.value | json }}</pre> -->
      <ul>
        <li *ngFor="let shipUpgrade of shipUpgrades.value | keyvalue">
          <ng-container *ngIf="shipUpgrade.value">
            {{ shipUpgrade.value.name | titlecase }}:
            {{ shipUpgrade.value.included ? "Acquired" : "Not Acquired" }}
          </ng-container>
        </li>
      </ul>

      <h3>Oculus Squadmates</h3>
      <!-- <pre>{{ oculusSquadmates.value | json }}</pre> -->
      <ul>
        <li *ngFor="let oculusSquadmate of oculusSquadmates.value | keyvalue">
          <ng-container>
            {{ convertFromCamelCase(oculusSquadmate.key) }}:
            {{ oculusSquadmate.value }}
          </ng-container>
        </li>
      </ul>

      <h3>Infiltration</h3>
      <!-- <pre>{{ infiltrationTeam.value | json }}</pre> -->
      <ul>
        <li *ngFor="let infiltration of infiltrationTeam.value | keyvalue">
          <ng-container>
            {{ convertFromCamelCase(infiltration.key) }}:
            {{ infiltration.value }}
          </ng-container>
        </li>
      </ul>

      <h3>The Long Walk</h3>
      <!-- <pre>{{ longWalkTeam.value | json }}</pre> -->
      <ul>
        <li *ngFor="let longWalk of longWalkTeam.value | keyvalue">
          <ng-container>
            {{ convertFromCamelCase(longWalk.key) }}: {{ longWalk.value }}
          </ng-container>
        </li>
      </ul>

      <h3>Final Battle</h3>
      <!-- <pre>{{ finalBattleTeam.value | json }}</pre> -->
      <ul>
        <li *ngFor="let finalBattle of finalBattleTeam.value | keyvalue">
          <ng-container>
            {{ convertFromCamelCase(finalBattle.key) }}:
            {{ finalBattle.value }}
          </ng-container>
        </li>
      </ul>

      <h3>Hold the Line</h3>
      <p>
        There {{ currentHtlScores.size > 1 ? "are" : "is" }}
        <strong>{{ currentHtlScores.size }}</strong> squadmate{{
          currentHtlScores.size > 1 ? "s" : ""
        }}
        holding the line. Their individual score{{
          currentHtlScores.size > 1 ? "s are" : " is"
        }}
        as follows:
      </p>

      <ul>
        <ng-container *ngFor="let entry of currentHtlScores | keyvalue">
          <li>{{ entry.key }}: {{ entry.value }}</li>
        </ng-container>
      </ul>

      The total squadmate score is <strong>{{ totalHtlScore }}</strong
      >.

      <p>
        <strong>{{
          htlScore == currentHtlScores.size ? 'All' : htlScore
        }}</strong>
        squadmate{{ htlScore > 1 ? 's' : '' }} holding the line will survive. ({{ totalHtlScore }} / 3 =
        {{ htlScore }} rounded down)
      </p>
    </mat-step>

    <!--  <mat-step [editable]="false">
      <ng-template matStepLabel>Ship Upgrades</ng-template>

      <button mat-raised-button color="primary" matStepperNext>Next</button>
    </mat-step> -->
  </mat-stepper>

  <!-- <ul>
    <li *ngFor="let squadmate of availableSquadmates">
      {{ squadmate.name }} -
      {{
        squadmate.deathReason ? "Dead (" + squadmate.deathReason + ")" : "Alive"
      }}
    </li>
  </ul> -->
</div>
